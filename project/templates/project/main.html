<!-- file: project/templates/project/main.html -->
<!-- author: Ashtosh Bhandari ashtosh@bu.edu -->
<!-- description: Main page showing all media items -->

{% extends 'project/base.html' %}

{% block title %}All Movies & Shows{% endblock %}

{% block content %}
<h1>All Movies & Shows</h1>

<!-- Search and Filter Form -->
<div class="filter-section">
    <form method="get" action="{% url 'main' %}" class="filter-form">
        <div class="search-box">
            <input type="text" name="search" placeholder="Search by title..." value="{{ search_query }}">
            <button type="submit">Search</button>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="type">Media Type:</label>
                <select name="type" id="type">
                    <option value="">All</option>
                    {% for value, label in media_types %}
                        <option value="{{ value }}" {% if selected_type == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter-group">
                <label for="min_rating">Min Rating:</label>
                <input type="number" name="min_rating" id="min_rating" min="0" max="10" value="{{ min_rating }}" placeholder="0">
            </div>

            <div class="filter-group">
                <label for="max_rating">Max Rating:</label>
                <input type="number" name="max_rating" id="max_rating" min="0" max="10" value="{{ max_rating }}" placeholder="10">
            </div>

            <div class="filter-group">
                <label for="release_year">Release Year:</label>
                <input type="number" name="release_year" id="release_year" value="{{ release_year }}" placeholder="e.g. 2024">
            </div>

            <button type="submit" class="filter-btn">Apply Filters</button>
            <a href="{% url 'main' %}" class="clear-btn">Clear</a>
        </div>
    </form>
</div>

{% if media_items %}
    <div class="media-grid">
        {% for item in media_items %}
            <a href="{% url 'media_detail' item.pk %}" class="media-card">
                {% if item.poster_url %}
                    <img src="{{ item.poster_url }}" alt="{{ item.title }} poster">
                {% endif %}

                <span class="media-type">{{ item.get_type_display }}</span>

                <h3>{{ item.title }}</h3>

                <p class="release-date">Released: {{ item.release_date }}</p>

                {% if item.rating %}
                    <p><strong>Rating:</strong> {{ item.rating }}/10</p>
                {% endif %}
            </a>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_type %}&type={{ selected_type }}{% endif %}{% if min_rating %}&min_rating={{ min_rating }}{% endif %}{% if max_rating %}&max_rating={{ max_rating }}{% endif %}{% if release_year %}&release_year={{ release_year }}{% endif %}">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_type %}&type={{ selected_type }}{% endif %}{% if min_rating %}&min_rating={{ min_rating }}{% endif %}{% if max_rating %}&max_rating={{ max_rating }}{% endif %}{% if release_year %}&release_year={{ release_year }}{% endif %}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_type %}&type={{ selected_type }}{% endif %}{% if min_rating %}&min_rating={{ min_rating }}{% endif %}{% if max_rating %}&max_rating={{ max_rating }}{% endif %}{% if release_year %}&release_year={{ release_year }}{% endif %}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_type %}&type={{ selected_type }}{% endif %}{% if min_rating %}&min_rating={{ min_rating }}{% endif %}{% if max_rating %}&max_rating={{ max_rating }}{% endif %}{% if release_year %}&release_year={{ release_year }}{% endif %}">last &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
{% else %}
    <p class="empty-message">No media items found matching your criteria.</p>
{% endif %}
{% endblock %}
